<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reversing a simple keygen with rizin</title>
<meta name="author" content="8dcc" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="../css/main.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Reversing a simple keygen with rizin</h1>
<p>
<a href="../index.html">Index</a> | <a href="index.html">Up</a>
</p>

<hr />

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3cdb5e1">1. Introduction</a></li>
<li><a href="#org1de97e4">2. Trying out the program</a></li>
<li><a href="#orgf8524d7">3. The main function</a>
<ul>
<li><a href="#org1a85c9a">3.1. Finding the main function</a></li>
<li><a href="#org31ed883">3.2. Disassembling the main function</a></li>
</ul>
</li>
<li><a href="#org4e95567">4. Disassembling the key generator</a></li>
<li><a href="#org87d87b5">5. Alternative: Decompiling with IDA or ghidra</a>
<ul>
<li><a href="#orga4e213b">5.1. IDA Pro</a></li>
<li><a href="#org2859a44">5.2. Rizin's version of ghidra</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3cdb5e1" class="outline-2">
<h2 id="org3cdb5e1"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
I created a simple keygen program that takes a user and a key, and prints a
message if the key is valid. Let's try to figure out how to make a keygen for
it. I made an article explaining how keygens work, and how to make your own. I
will not be using the same code, but feel free to check <a href="../programming/creating-keygen.html">Creating a simple keygen</a>
in case you are interested.
</p>
</div>
</div>

<div id="outline-container-org1de97e4" class="outline-2">
<h2 id="org1de97e4"><span class="section-number-2">2.</span> Trying out the program</h2>
<div class="outline-text-2" id="text-2">
<p>
First, let's try running the program to see what it's asking.
</p>

<pre class="example" id="orged3363b">
Username: test
Key: test
Invalid key.
</pre>

<p>
From this, we can at least expect:
</p>
<ul class="org-ul">
<li>A call to something like <code>printf()</code> with <code>"Username:"</code> in the arguments.</li>
<li>Some call for scanning the username, perhaps <code>getchar()</code>, <code>gets()</code> or <code>scanf()</code>.</li>
<li>Another call to <code>printf()</code> with <code>"Key:"</code> in the arguments.</li>
<li>Another call for scanning the key.</li>
<li>Some kind of key validation.</li>
<li>Depending on the result, a last call to <code>printf()</code> with the text <code>"Invalid key."</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-orgf8524d7" class="outline-2">
<h2 id="orgf8524d7"><span class="section-number-2">3.</span> The main function</h2>
<div class="outline-text-2" id="text-3">
<p>
Let's start by having a look at the main function with <a href="https://rizin.re/">rizin</a> 0.6.3 (you can also
use <a href="https://cutter.re">cutter</a> or <a href="https://hex-rays.com/ida-pro/">IDA</a>, if you prefer a GUI program).
</p>
</div>

<div id="outline-container-org1a85c9a" class="outline-3">
<h3 id="org1a85c9a"><span class="section-number-3">3.1.</span> Finding the main function</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We start by running the <code>aaa</code> rizin command, which is used to "Analyze all calls,
references, emulation and apply signatures".
</p>

<div class="org-src-container">
<pre class="src src-nasm">$ rizin ./my_keygen
[<span style="color: #88ca9f;">0x000010a0</span>]&gt; <span style="color: #feacd0;">aaa</span>
[x] Analyze all flags starting with sym. <span style="color: #feacd0;">and</span> entry0 (aa)
[x] Analyze function calls
[x] Analyze len bytes of instructions for references
[x] Check for classes
[x] Analyze local variables <span style="color: #feacd0;">and</span> arguments
[x] Type matching analysis for all functions
[x] Applied <span style="color: #88ca9f;">0</span> FLIRT signatures via sigdb
[x] Propagate noreturn information
[x] Resolve pointers <span style="color: #79a8ff;">to</span> data sections
[x] Use -AA <span style="color: #feacd0;">or</span> aaaa <span style="color: #79a8ff;">to</span> perform additional experimental analysis.
</pre>
</div>

<p>
We can list the symbols (flags) with <code>fl</code>. In this case, rizin couldn't find the
<code>main</code> function.
</p>

<blockquote>
<p>
<b>Note:</b> With <code>command~text</code>, we can filter rizin's output.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-nasm">[<span style="color: #88ca9f;">0x000010a0</span>]&gt; fl~main
<span style="color: #88ca9f;">0x00003fc0</span> <span style="color: #88ca9f;">8</span> reloc.__libc_start_main
<span style="color: #88ca9f;">0x00004080</span> <span style="color: #88ca9f;">8</span> reloc.target.__libc_start_main
</pre>
</div>

<p>
This is not a problem, though, since we can just print the entry point of the
program with <code>pdf</code> (print disassembly of function) to determine where our main
function is.
</p>

<blockquote>
<p>
<b>Note:</b> Using <code>command@location</code> executes the command at that position. In this
case, rizin has placed us into <code>entry0</code> already, so this is not necessary. We
could also use <code>s location</code> (seek) and then <code>command</code>.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-nasm">[<span style="color: #88ca9f;">0x000010a0</span>]&gt; pdf @ entry0
&#9474;         entry0                      <span style="color: #989898;">;</span><span style="color: #989898;">-- section..text:</span>
&#9484;         entry0                     entry0(int64_t arg3)<span style="color: #989898;">;</span>
&#9474;         entry0                     <span style="color: #989898;">; </span><span style="color: #989898;">arg int64_t arg3 @ rdx</span>
&#9474;         entry0                          <span style="color: #88ca9f;">31</span> ed                       <span style="color: #feacd0;">xor</span>   <span style="color: #6ae4b9;">ebp</span>, <span style="color: #6ae4b9;">ebp</span>                <span style="color: #989898;">; </span><span style="color: #989898;">[13] -r-x section size 1492 named .text</span>
&#9474;         entry0+<span style="color: #88ca9f;">0x2</span>                      <span style="color: #88ca9f;">49</span> <span style="color: #88ca9f;">89</span> d1                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">r9</span>, <span style="color: #6ae4b9;">rdx</span>                 <span style="color: #989898;">; </span><span style="color: #989898;">arg3</span>
&#9474;         entry0+<span style="color: #88ca9f;">0x5</span>                      <span style="color: #88ca9f;">5e</span>                          <span style="color: #feacd0;">pop</span>   <span style="color: #6ae4b9;">rsi</span>
&#9474;         entry0+<span style="color: #88ca9f;">0x6</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> e2                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdx</span>, <span style="color: #6ae4b9;">rsp</span>
&#9474;         entry0+<span style="color: #88ca9f;">0x9</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">83</span> e4 f0                 <span style="color: #feacd0;">and</span>   <span style="color: #6ae4b9;">rsp</span>, <span style="color: #88ca9f;">0xfffffffffffffff0</span>
&#9474;         entry0+<span style="color: #88ca9f;">0xd</span>                      <span style="color: #88ca9f;">50</span>                          <span style="color: #feacd0;">push</span>  <span style="color: #6ae4b9;">rax</span>
&#9474;         entry0+<span style="color: #88ca9f;">0xe</span>                      <span style="color: #88ca9f;">54</span>                          <span style="color: #feacd0;">push</span>  <span style="color: #6ae4b9;">rsp</span>
&#9474;         entry0+<span style="color: #88ca9f;">0xf</span>                      <span style="color: #88ca9f;">45</span> <span style="color: #88ca9f;">31</span> c0                    <span style="color: #feacd0;">xor</span>   <span style="color: #6ae4b9;">r8d</span>, <span style="color: #6ae4b9;">r8d</span>
&#9474;         entry0+<span style="color: #88ca9f;">0x12</span>                     <span style="color: #88ca9f;">31</span> c9                       <span style="color: #feacd0;">xor</span>   <span style="color: #6ae4b9;">ecx</span>, <span style="color: #6ae4b9;">ecx</span>
&#9474;         entry0+<span style="color: #88ca9f;">0x14</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">3d</span> <span style="color: #88ca9f;">4e</span> <span style="color: #88ca9f;">03</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rdi</span>, data.00001409      <span style="color: #989898;">; </span><span style="color: #989898;">0x1409</span>
&#9492;         entry0+<span style="color: #88ca9f;">0x1b</span>                     ff <span style="color: #88ca9f;">15</span> ff <span style="color: #88ca9f;">2e</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>           <span style="color: #feacd0;">call</span>  <span style="color: #79a8ff;">qword</span> reloc.__libc_start_main <span style="color: #989898;">; </span><span style="color: #989898;">[reloc.__libc_start_main:8]=0x4080 reloc.target.__libc_start_main</span>
[<span style="color: #88ca9f;">0x000010a0</span>]&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org31ed883" class="outline-3">
<h3 id="org31ed883"><span class="section-number-3">3.2.</span> Disassembling the main function</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The address being loaded into <code>rdi</code> at <code>entry0+0x14</code> should be our main function. Let's have a look.
</p>

<div class="org-src-container">
<pre class="src src-nasm">[<span style="color: #88ca9f;">0x000010a0</span>]&gt; pd <span style="color: #88ca9f;">60</span> @ data.00001409
          <span style="color: #989898;">; </span><span style="color: #989898;">DATA XREF from entry0 @ 0x10b4</span>
          main                      <span style="color: #989898;">;</span><span style="color: #989898;">-- data.00001409:</span>
          main                      <span style="color: #989898;">;</span><span style="color: #989898;">-- main:</span>
          main                          <span style="color: #88ca9f;">55</span>                          <span style="color: #feacd0;">push</span>  <span style="color: #6ae4b9;">rbp</span>
          main+<span style="color: #88ca9f;">0x1</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> e5                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rbp</span>, <span style="color: #6ae4b9;">rsp</span>
          main+<span style="color: #88ca9f;">0x4</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">83</span> ec <span style="color: #88ca9f;">10</span>                 <span style="color: #feacd0;">sub</span>   <span style="color: #6ae4b9;">rsp</span>, <span style="color: #88ca9f;">0x10</span>
          main+<span style="color: #88ca9f;">0x8</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> f1 <span style="color: #88ca9f;">0b</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, str.Username:        <span style="color: #989898;">; </span><span style="color: #989898;">0x2009 ; "Username: "</span>
          main+<span style="color: #88ca9f;">0xf</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x12</span>                     b8 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>              <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #88ca9f;">0</span>
          main+<span style="color: #88ca9f;">0x17</span>                     e8 <span style="color: #88ca9f;">3b</span> fc ff ff              <span style="color: #feacd0;">call</span>  sym.imp.printf            <span style="color: #989898;">; </span><span style="color: #989898;">sym.imp.printf ; int printf(const char *format)</span>
          main+<span style="color: #88ca9f;">0x1c</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> <span style="color: #88ca9f;">34</span> <span style="color: #88ca9f;">2c</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, [<span style="color: #88ca9f;">0x00004060</span>]
          main+<span style="color: #88ca9f;">0x23</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c6                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rsi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x26</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> de <span style="color: #88ca9f;">0b</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, str.255s             <span style="color: #989898;">; </span><span style="color: #989898;">0x2014 ; "%255s"</span>
          main+<span style="color: #88ca9f;">0x2d</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x30</span>                     b8 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>              <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #88ca9f;">0</span>
          main+<span style="color: #88ca9f;">0x35</span>                     e8 <span style="color: #88ca9f;">3d</span> fc ff ff              <span style="color: #feacd0;">call</span>  sym.imp.__isoc99_scanf    <span style="color: #989898;">; </span><span style="color: #989898;">sym.imp.__isoc99_scanf ; int scanf(const char *format)</span>
          main+<span style="color: #88ca9f;">0x3a</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> d0 <span style="color: #88ca9f;">0b</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, str.Key:             <span style="color: #989898;">; </span><span style="color: #989898;">0x201a ; "Key: "</span>
          main+<span style="color: #88ca9f;">0x41</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x44</span>                     b8 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>              <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #88ca9f;">0</span>
          main+<span style="color: #88ca9f;">0x49</span>                     e8 <span style="color: #88ca9f;">09</span> fc ff ff              <span style="color: #feacd0;">call</span>  sym.imp.printf            <span style="color: #989898;">; </span><span style="color: #989898;">sym.imp.printf ; int printf(const char *format)</span>
          main+<span style="color: #88ca9f;">0x4e</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> <span style="color: #88ca9f;">02</span> <span style="color: #88ca9f;">2d</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, [<span style="color: #88ca9f;">0x00004160</span>]
          main+<span style="color: #88ca9f;">0x55</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x58</span>                     e8 <span style="color: #88ca9f;">41</span> fe ff ff              <span style="color: #feacd0;">call</span>  fcn.000012a7              <span style="color: #989898;">; </span><span style="color: #989898;">fcn.000012a7</span>
          main+<span style="color: #88ca9f;">0x5d</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> <span style="color: #88ca9f;">13</span> <span style="color: #88ca9f;">2d</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, [<span style="color: #88ca9f;">0x00004180</span>]
          main+<span style="color: #88ca9f;">0x64</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c6                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rsi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x67</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> e9 <span style="color: #88ca9f;">2b</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, [<span style="color: #88ca9f;">0x00004060</span>]
          main+<span style="color: #88ca9f;">0x6e</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x71</span>                     e8 <span style="color: #88ca9f;">06</span> fd ff ff              <span style="color: #feacd0;">call</span>  fcn.00001185              <span style="color: #989898;">; </span><span style="color: #989898;">fcn.00001185</span>
          main+<span style="color: #88ca9f;">0x76</span>                     ba <span style="color: #88ca9f;">14</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>              <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">edx</span>, <span style="color: #88ca9f;">0x14</span>
          main+<span style="color: #88ca9f;">0x7b</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> f5 <span style="color: #88ca9f;">2c</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, [<span style="color: #88ca9f;">0x00004180</span>]
          main+<span style="color: #88ca9f;">0x82</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c6                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rsi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x85</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> cb <span style="color: #88ca9f;">2c</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, [<span style="color: #88ca9f;">0x00004160</span>]
          main+<span style="color: #88ca9f;">0x8c</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
          main+<span style="color: #88ca9f;">0x8f</span>                     e8 d3 fb ff ff              <span style="color: #feacd0;">call</span>  sym.imp.memcmp            <span style="color: #989898;">; </span><span style="color: #989898;">sym.imp.memcmp ; int memcmp(const void *s1, const void *s2, size_t n)</span>
          main+<span style="color: #88ca9f;">0x94</span>                     <span style="color: #88ca9f;">85</span> c0                       <span style="color: #feacd0;">test</span>  <span style="color: #6ae4b9;">eax</span>, <span style="color: #6ae4b9;">eax</span>
          main+<span style="color: #88ca9f;">0x96</span>                     <span style="color: #88ca9f;">0f</span> <span style="color: #88ca9f;">94</span> c0                    <span style="color: #feacd0;">sete</span>  <span style="color: #6ae4b9;">al</span>
          main+<span style="color: #88ca9f;">0x99</span>                     <span style="color: #88ca9f;">88</span> <span style="color: #88ca9f;">45</span> ff                    <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - <span style="color: #88ca9f;">1</span>], <span style="color: #6ae4b9;">al</span>
          main+<span style="color: #88ca9f;">0x9c</span>                     <span style="color: #88ca9f;">80</span> <span style="color: #88ca9f;">7d</span> ff <span style="color: #88ca9f;">00</span>                 <span style="color: #feacd0;">cmp</span>   <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - <span style="color: #88ca9f;">1</span>], <span style="color: #88ca9f;">0</span>
      &#9484;&#9472;&lt; main+<span style="color: #88ca9f;">0xa0</span>                     <span style="color: #88ca9f;">74</span> <span style="color: #88ca9f;">11</span>                       <span style="color: #feacd0;">je</span>    <span style="color: #88ca9f;">0x14bc</span>
      &#9474;   main+<span style="color: #88ca9f;">0xa2</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> <span style="color: #88ca9f;">6e</span> <span style="color: #88ca9f;">0b</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, str.Correct_key.     <span style="color: #989898;">; </span><span style="color: #989898;">0x2020 ; "Correct key."</span>
      &#9474;   main+<span style="color: #88ca9f;">0xa9</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
      &#9474;   main+<span style="color: #88ca9f;">0xac</span>                     e8 <span style="color: #88ca9f;">76</span> fb ff ff              <span style="color: #feacd0;">call</span>  sym.imp.puts              <span style="color: #989898;">; </span><span style="color: #989898;">sym.imp.puts ; int puts(const char *s)</span>
     &#9484;&#9472;&#9472;&lt; main+<span style="color: #88ca9f;">0xb1</span>                     eb <span style="color: #88ca9f;">0f</span>                       <span style="color: #feacd0;">jmp</span>   <span style="color: #88ca9f;">0x14cb</span>
     &#9474;&#9492;&#9472;&gt; main+<span style="color: #88ca9f;">0xb3</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">05</span> <span style="color: #88ca9f;">6a</span> <span style="color: #88ca9f;">0b</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">rax</span>, str.Invalid_key.     <span style="color: #989898;">; </span><span style="color: #989898;">0x202d ; "Invalid key."</span>
     &#9474;    main+<span style="color: #88ca9f;">0xba</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>
     &#9474;    main+<span style="color: #88ca9f;">0xbd</span>                     e8 <span style="color: #88ca9f;">65</span> fb ff ff              <span style="color: #feacd0;">call</span>  sym.imp.puts              <span style="color: #989898;">; </span><span style="color: #989898;">sym.imp.puts ; int puts(const char *s)</span>
     &#9474;    <span style="color: #989898;">; </span><span style="color: #989898;">CODE XREF from data.00001409 @ +0xb1</span>
     &#9492;&#9472;&#9472;&gt; main+<span style="color: #88ca9f;">0xc2</span>                     b8 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>              <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #88ca9f;">0</span>
          main+<span style="color: #88ca9f;">0xc7</span>                     c9                          <span style="color: #feacd0;">leave</span>
          main+<span style="color: #88ca9f;">0xc8</span>                     c3                          <span style="color: #feacd0;">ret</span>
</pre>
</div>

<blockquote>
<p>
<b>Note:</b> I renamed this function to "main" with <code>f+ main 0x9c @ data.00001409</code>.
</p>
</blockquote>

<p>
In here, we can see that it matches the pattern we saw when running the program.
From <code>main+0x8</code> to <code>main+0x17</code>, it calls <code>printf("Username: ")</code>, and from <code>main+0x1c</code> to
<code>main+0x35</code> it uses <code>scanf("%255s", user)</code> to read the user, where <i>user</i> is at
address <code>0x4060</code>.
</p>

<p>
Similarly, from <code>main+0x3a</code> to <code>main+0x49</code> it calls <code>printf("Key: ")</code>, but instead of
calling <code>scanf()</code>, from <code>main+0x4e</code> to <code>main+0x58</code> it calls an unknown function at
<code>0x12a7</code> with <code>0x4160</code> as argument. We can safely asume that it scans for the user
key, so we will rename the function to <code>get_key()</code>, and the parameter <code>user_key</code>.
</p>

<p>
From <code>main+0x5d</code> to <code>main+0x71</code>, it calls an unknown function at <code>0x1185</code> with the
<code>user</code> we got from <code>scanf()</code> and <code>0x4180</code> as arguments. This looks very promising,
since it will compare this <code>0x4180</code> value with <code>user_key</code> right bellow. For this
reason, we will call this function <code>generate_key()</code> and the second parameter at
<code>0x4180</code>, <code>real_key</code>.
</p>

<p>
From <code>main+0x76</code> to <code>main+0xbd</code> it calls <code>memcmp(user_key, real_key, 0x14)</code> and prints
"Correct key." or "Invalid key." depending on the returned value by <code>memcmp</code>. From
this call we also know that the key size should be 0x14 (20).
</p>

<p>
This is obviously an ideal environment, since the main function is the one
responsible for validating the key. Since this is not normally the case, we
could try to look for those success and fail messages in the program's string
list, and checking the xrefs to find the key validation function. In this
specific program, we could also just patch the bytes to either show us the real
key, or change the conditional jump so it always jumps to the code that gets
executed when the key is correct.
</p>
</div>
</div>
</div>

<div id="outline-container-org4e95567" class="outline-2">
<h2 id="org4e95567"><span class="section-number-2">4.</span> Disassembling the key generator</h2>
<div class="outline-text-2" id="text-4">
<p>
Now that we understand the main logic, let's have a look at the <code>generate_key()</code>
function at <code>0x1185</code>.
</p>

<div class="org-src-container">
<pre class="src src-nasm">[<span style="color: #88ca9f;">0x000010a0</span>]&gt; pdf @ fcn.00001185
          <span style="color: #989898;">; </span><span style="color: #989898;">CALL XREF from data.00001409 @ +0x71</span>
&#9474;         fcn.00001185                      <span style="color: #989898;">;</span><span style="color: #989898;">-- keygen:</span>
&#9484;         fcn.00001185                     fcn.00001185(const char *arg1, int64_t arg2)<span style="color: #989898;">;</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">arg const char *arg1 @ rdi</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">arg int64_t arg2 @ rsi</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">var int64_t var_38h @ stack - 0x38</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">var const char *s @ stack - 0x30</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">var int64_t var_19h @ stack - 0x19</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">var int64_t var_18h @ stack - 0x18</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">var int64_t var_14h @ stack - 0x14</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">var int64_t var_10h @ stack - 0x10</span>
&#9474;         fcn.00001185                     <span style="color: #989898;">; </span><span style="color: #989898;">var size_t var_ch @ stack - 0xc</span>
&#9474;         fcn.00001185                          <span style="color: #88ca9f;">55</span>                          <span style="color: #feacd0;">push</span>  <span style="color: #6ae4b9;">rbp</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x1</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> e5                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rbp</span>, <span style="color: #6ae4b9;">rsp</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x4</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">83</span> ec <span style="color: #88ca9f;">30</span>                 <span style="color: #feacd0;">sub</span>   <span style="color: #6ae4b9;">rsp</span>, <span style="color: #88ca9f;">0x30</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x8</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> <span style="color: #88ca9f;">7d</span> d8                 <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">qword</span> [<span style="color: #6ae4b9;">rbp</span> - s], <span style="color: #6ae4b9;">rdi</span> <span style="color: #989898;">; </span><span style="color: #989898;">arg1</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0xc</span>                      <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> <span style="color: #88ca9f;">75</span> d0                 <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">qword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">38h</span>], <span style="color: #6ae4b9;">rsi</span> <span style="color: #989898;">; </span><span style="color: #989898;">arg2</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x10</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> d8                 <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rax</span>, <span style="color: #79a8ff;">qword</span> [<span style="color: #6ae4b9;">rbp</span> - s]
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x14</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">89</span> c7                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rdi</span>, <span style="color: #6ae4b9;">rax</span>          <span style="color: #989898;">; </span><span style="color: #989898;">const char *s</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x17</span>                     e8 <span style="color: #88ca9f;">9f</span> fe ff ff              <span style="color: #feacd0;">call</span>  sym.imp.strlen    <span style="color: #989898;">; </span><span style="color: #989898;">sym.imp.strlen ; size_t strlen(const char *s)</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x1c</span>                     <span style="color: #88ca9f;">89</span> <span style="color: #88ca9f;">45</span> fc                    <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_ch], <span style="color: #6ae4b9;">eax</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x1f</span>                     c7 <span style="color: #88ca9f;">45</span> f0 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">18h</span>], <span style="color: #88ca9f;">0</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0x26</span>                     c7 <span style="color: #88ca9f;">45</span> f4 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">14h</span>], <span style="color: #88ca9f;">0</span>
&#9474;     &#9484;&#9472;&lt; fcn.00001185+<span style="color: #88ca9f;">0x2d</span>                     e9 <span style="color: #88ca9f;">93</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>              <span style="color: #feacd0;">jmp</span>   <span style="color: #88ca9f;">0x124a</span>
&#9474;    &#9484;&#9472;&#9472;&gt; fcn.00001185+<span style="color: #88ca9f;">0x32</span>                     c7 <span style="color: #88ca9f;">45</span> f8 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">10h</span>], <span style="color: #88ca9f;">0</span>
&#9474;   &#9484;&#9472;&#9472;&#9472;&lt; fcn.00001185+<span style="color: #88ca9f;">0x39</span>                     eb <span style="color: #88ca9f;">6e</span>                       <span style="color: #feacd0;">jmp</span>   <span style="color: #88ca9f;">0x122e</span>
&#9474;  &#9484;&#9472;&#9472;&#9472;&#9472;&gt; fcn.00001185+<span style="color: #88ca9f;">0x3b</span>                     <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> f8                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">10h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x3e</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">63</span> d0                    <span style="color: #feacd0;">movsxd</span> <span style="color: #6ae4b9;">rdx</span>, <span style="color: #6ae4b9;">eax</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x41</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> d8                 <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rax</span>, <span style="color: #79a8ff;">qword</span> [<span style="color: #6ae4b9;">rbp</span> - s]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x45</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">01</span> d0                    <span style="color: #feacd0;">add</span>   <span style="color: #6ae4b9;">rax</span>, <span style="color: #6ae4b9;">rdx</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x48</span>                     <span style="color: #88ca9f;">0f</span> b6 <span style="color: #88ca9f;">00</span>                    <span style="color: #feacd0;">movzx</span> <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rax</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x4b</span>                     <span style="color: #88ca9f;">88</span> <span style="color: #88ca9f;">45</span> ef                    <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>], <span style="color: #6ae4b9;">al</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x4e</span>                     <span style="color: #88ca9f;">0f</span> b6 <span style="color: #88ca9f;">45</span> ef                 <span style="color: #feacd0;">movzx</span> <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x52</span>                     c1 e0 <span style="color: #88ca9f;">04</span>                    <span style="color: #feacd0;">shl</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #88ca9f;">4</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x55</span>                     <span style="color: #88ca9f;">89</span> c2                       <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">edx</span>, <span style="color: #6ae4b9;">eax</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x57</span>                     <span style="color: #88ca9f;">0f</span> b6 <span style="color: #88ca9f;">45</span> ef                 <span style="color: #feacd0;">movzx</span> <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x5b</span>                     c0 e8 <span style="color: #88ca9f;">04</span>                    <span style="color: #feacd0;">shr</span>   <span style="color: #6ae4b9;">al</span>, <span style="color: #88ca9f;">4</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x5e</span>                     <span style="color: #88ca9f;">09</span> d0                       <span style="color: #feacd0;">or</span>    <span style="color: #6ae4b9;">eax</span>, <span style="color: #6ae4b9;">edx</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x60</span>                     <span style="color: #88ca9f;">88</span> <span style="color: #88ca9f;">45</span> ef                    <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>], <span style="color: #6ae4b9;">al</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x63</span>                     <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> f4                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">14h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x66</span>                     <span style="color: #88ca9f;">89</span> c2                       <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">edx</span>, <span style="color: #6ae4b9;">eax</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x68</span>                     <span style="color: #88ca9f;">0f</span> b6 <span style="color: #88ca9f;">45</span> ef                 <span style="color: #feacd0;">movzx</span> <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x6c</span>                     <span style="color: #88ca9f;">31</span> d0                       <span style="color: #feacd0;">xor</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #6ae4b9;">edx</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x6e</span>                     <span style="color: #88ca9f;">88</span> <span style="color: #88ca9f;">45</span> ef                    <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>], <span style="color: #6ae4b9;">al</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x71</span>                     <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> fc                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_ch]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x74</span>                     <span style="color: #88ca9f;">89</span> c2                       <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">edx</span>, <span style="color: #6ae4b9;">eax</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x76</span>                     <span style="color: #88ca9f;">0f</span> b6 <span style="color: #88ca9f;">45</span> ef                 <span style="color: #feacd0;">movzx</span> <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x7a</span>                     <span style="color: #88ca9f;">31</span> d0                       <span style="color: #feacd0;">xor</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #6ae4b9;">edx</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x7c</span>                     <span style="color: #88ca9f;">88</span> <span style="color: #88ca9f;">45</span> ef                    <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>], <span style="color: #6ae4b9;">al</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x7f</span>                     <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> f0                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">18h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x82</span>                     <span style="color: #88ca9f;">8d</span> <span style="color: #88ca9f;">50</span> <span style="color: #88ca9f;">01</span>                    <span style="color: #feacd0;">lea</span>   <span style="color: #6ae4b9;">edx</span>, [<span style="color: #6ae4b9;">rax</span> + <span style="color: #88ca9f;">1</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x85</span>                     <span style="color: #88ca9f;">89</span> <span style="color: #88ca9f;">55</span> f0                    <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">18h</span>], <span style="color: #6ae4b9;">edx</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x88</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">63</span> d0                    <span style="color: #feacd0;">movsxd</span> <span style="color: #6ae4b9;">rdx</span>, <span style="color: #6ae4b9;">eax</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x8b</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> d0                 <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rax</span>, <span style="color: #79a8ff;">qword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">38h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x8f</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">01</span> c2                    <span style="color: #feacd0;">add</span>   <span style="color: #6ae4b9;">rdx</span>, <span style="color: #6ae4b9;">rax</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x92</span>                     <span style="color: #88ca9f;">0f</span> b6 <span style="color: #88ca9f;">45</span> ef                 <span style="color: #feacd0;">movzx</span> <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">19h</span>]
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x96</span>                     <span style="color: #88ca9f;">88</span> <span style="color: #88ca9f;">02</span>                       <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rdx</span>], <span style="color: #6ae4b9;">al</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x98</span>                     <span style="color: #88ca9f;">83</span> <span style="color: #88ca9f;">7d</span> f0 <span style="color: #88ca9f;">13</span>                 <span style="color: #feacd0;">cmp</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">18h</span>], <span style="color: #88ca9f;">0x13</span>
&#9474; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&lt; fcn.00001185+<span style="color: #88ca9f;">0x9c</span>                     <span style="color: #88ca9f;">7e</span> <span style="color: #88ca9f;">07</span>                       <span style="color: #feacd0;">jle</span>   <span style="color: #88ca9f;">0x122a</span>
&#9474; &#9474;&#9550;&#9474;&#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0x9e</span>                     c7 <span style="color: #88ca9f;">45</span> f0 <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span> <span style="color: #88ca9f;">00</span>        <span style="color: #feacd0;">mov</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">18h</span>], <span style="color: #88ca9f;">0</span>
&#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&gt; fcn.00001185+<span style="color: #88ca9f;">0xa5</span>                     <span style="color: #88ca9f;">83</span> <span style="color: #88ca9f;">45</span> f8 <span style="color: #88ca9f;">01</span>                 <span style="color: #feacd0;">add</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">10h</span>], <span style="color: #88ca9f;">1</span>
&#9474;  &#9550;&#9474;&#9550;&#9474;   <span style="color: #989898;">; </span><span style="color: #989898;">CODE XREF from fcn.00001185 @ 0x11be</span>
&#9474;  &#9550;&#9492;&#9472;&#9472;&#9472;&gt; fcn.00001185+<span style="color: #88ca9f;">0xa9</span>                     <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> f8                    <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">10h</span>]
&#9474;  &#9550; &#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0xac</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">63</span> d0                    <span style="color: #feacd0;">movsxd</span> <span style="color: #6ae4b9;">rdx</span>, <span style="color: #6ae4b9;">eax</span>
&#9474;  &#9550; &#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0xaf</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">8b</span> <span style="color: #88ca9f;">45</span> d8                 <span style="color: #feacd0;">mov</span>   <span style="color: #6ae4b9;">rax</span>, <span style="color: #79a8ff;">qword</span> [<span style="color: #6ae4b9;">rbp</span> - s]
&#9474;  &#9550; &#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0xb3</span>                     <span style="color: #88ca9f;">48</span> <span style="color: #88ca9f;">01</span> d0                    <span style="color: #feacd0;">add</span>   <span style="color: #6ae4b9;">rax</span>, <span style="color: #6ae4b9;">rdx</span>
&#9474;  &#9550; &#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0xb6</span>                     <span style="color: #88ca9f;">0f</span> b6 <span style="color: #88ca9f;">00</span>                    <span style="color: #feacd0;">movzx</span> <span style="color: #6ae4b9;">eax</span>, <span style="color: #79a8ff;">byte</span> [<span style="color: #6ae4b9;">rax</span>]
&#9474;  &#9550; &#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0xb9</span>                     <span style="color: #88ca9f;">84</span> c0                       <span style="color: #feacd0;">test</span>  <span style="color: #6ae4b9;">al</span>, <span style="color: #6ae4b9;">al</span>
&#9474;  &#9492;&#9472;&#9472;&#9472;&#9472;&lt; fcn.00001185+<span style="color: #88ca9f;">0xbb</span>                     <span style="color: #88ca9f;">0f</span> <span style="color: #88ca9f;">85</span> <span style="color: #88ca9f;">7a</span> ff ff ff           <span style="color: #feacd0;">jne</span>   <span style="color: #88ca9f;">0x11c0</span>
&#9474;    &#9550;&#9474;   fcn.00001185+<span style="color: #88ca9f;">0xc1</span>                     <span style="color: #88ca9f;">83</span> <span style="color: #88ca9f;">45</span> f4 <span style="color: #88ca9f;">01</span>                 <span style="color: #feacd0;">add</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">14h</span>], <span style="color: #88ca9f;">1</span>
&#9474;    &#9550;&#9474;   <span style="color: #989898;">; </span><span style="color: #989898;">CODE XREF from fcn.00001185 @ 0x11b2</span>
&#9474;    &#9550;&#9492;&#9472;&gt; fcn.00001185+<span style="color: #88ca9f;">0xc5</span>                     <span style="color: #88ca9f;">83</span> <span style="color: #88ca9f;">7d</span> f4 <span style="color: #88ca9f;">04</span>                 <span style="color: #feacd0;">cmp</span>   <span style="color: #79a8ff;">dword</span> [<span style="color: #6ae4b9;">rbp</span> - var_<span style="color: #88ca9f;">14h</span>], <span style="color: #88ca9f;">4</span>
&#9474;    &#9492;&#9472;&#9472;&lt; fcn.00001185+<span style="color: #88ca9f;">0xc9</span>                     <span style="color: #88ca9f;">0f</span> <span style="color: #88ca9f;">8e</span> <span style="color: #88ca9f;">63</span> ff ff ff           <span style="color: #feacd0;">jle</span>   <span style="color: #88ca9f;">0x11b7</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0xcf</span>                     <span style="color: #88ca9f;">90</span>                          <span style="color: #feacd0;">nop</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0xd0</span>                     <span style="color: #88ca9f;">90</span>                          <span style="color: #feacd0;">nop</span>
&#9474;         fcn.00001185+<span style="color: #88ca9f;">0xd1</span>                     c9                          <span style="color: #feacd0;">leave</span>
&#9492;         fcn.00001185+<span style="color: #88ca9f;">0xd2</span>                     c3                          <span style="color: #feacd0;">ret</span>
</pre>
</div>

<p>
TODO
</p>
</div>
</div>

<div id="outline-container-org87d87b5" class="outline-2">
<h2 id="org87d87b5"><span class="section-number-2">5.</span> Alternative: Decompiling with IDA or ghidra</h2>
<div class="outline-text-2" id="text-5">
<p>
This option is not always reliable or not always available, so it's important to
understand how the actual assembly works before jumping into the decompiler.
</p>

<p>
There are various decompilers, and everyone has different opinions about which
one is the best. For me, even though I rather use free and open-source tools, I
find that the best decompiler is the IDA Pro one. Rizin (and therefore cutter)
has <a href="https://github.com/rizinorg/rz-ghidra">its own ghidra</a> plugin made in C++.
</p>

<p>
I will show a comparison between these two decompilers, but keep in mind that
decompiling a single program doesn't provide nearly enough data to judge the two
decompilers.
</p>

<blockquote>
<p>
<b>Note:</b> I formatted both outputs with <a href="https://github.com/8dcc/linux-dotfiles/blob/c5b5bcef1ea79397ae93accd7713616c9d6bd1ae/dotfiles/clang-format/clang-format">my clang-format</a> to make the outputs look as
similar as possible.
</p>
</blockquote>
</div>

<div id="outline-container-orga4e213b" class="outline-3">
<h3 id="orga4e213b"><span class="section-number-3">5.1.</span> IDA Pro</h3>
<div class="outline-text-3" id="text-5-1">
<p>
This is the generated C code by <i>IDA Pro Version 7.7.220118 Windows x64</i> (<i>x64
Decompiler Hex-Rays SA 7.7.0.220118</i>).
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #79a8ff;">size_t</span> <span style="color: #989898;">/* </span><span style="color: #989898;">__fastcall</span><span style="color: #989898;"> */</span> <span style="color: #4ae2ff;">sub_1185</span>(<span style="color: #ff6f9f;">const</span> <span style="color: #79a8ff;">char</span>* <span style="color: #6ae4b9;">a1</span>, <span style="color: #79a8ff;">__int64</span> <span style="color: #6ae4b9;">a2</span>) {
    <span style="color: #79a8ff;">size_t</span> <span style="color: #6ae4b9;">result</span>;    <span style="color: #989898;">// </span><span style="color: #989898;">rax</span>
    <span style="color: #79a8ff;">int</span> <span style="color: #6ae4b9;">v3</span>;           <span style="color: #989898;">// </span><span style="color: #989898;">eax</span>
    <span style="color: #79a8ff;">int</span> <span style="color: #6ae4b9;">v4</span>;           <span style="color: #989898;">// </span><span style="color: #989898;">[rsp+20h] [rbp-10h]</span>
    <span style="color: #79a8ff;">int</span> <span style="color: #6ae4b9;">i</span>;            <span style="color: #989898;">// </span><span style="color: #989898;">[rsp+24h] [rbp-Ch]</span>
    <span style="color: #79a8ff;">int</span> <span style="color: #6ae4b9;">j</span>;            <span style="color: #989898;">// </span><span style="color: #989898;">[rsp+28h] [rbp-8h]</span>
    <span style="color: #79a8ff;">char</span> <span style="color: #6ae4b9;">v7</span>;          <span style="color: #989898;">// </span><span style="color: #989898;">[rsp+2Ch] [rbp-4h]</span>

    result = strlen(a1);
    v7     = result;
    v4     = <span style="color: #88ca9f;">0</span>;
    <span style="color: #ff6f9f;">for</span> (i = <span style="color: #88ca9f;">0</span>; i &lt;= <span style="color: #88ca9f;">4</span>; ++i) {
        <span style="color: #ff6f9f;">for</span> (j = <span style="color: #88ca9f;">0</span>;; ++j) {
            result = a1[j];
            <span style="color: #ff6f9f;">if</span> (<span style="color: #ff6740; font-weight: bold;">!</span>result)
                <span style="color: #ff6f9f;">break</span>;

            v3 = v4++;
            , *(a2 + v3) = v7 ^ i ^ ((<span style="color: #88ca9f;">16</span> * a1[j]) | (a1[j] &gt;&gt; <span style="color: #88ca9f;">4</span>));
            <span style="color: #ff6f9f;">if</span> (v4 &gt; <span style="color: #88ca9f;">19</span>)
                v4 = <span style="color: #88ca9f;">0</span>;
        }
    }

    <span style="color: #ff6f9f;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2859a44" class="outline-3">
<h3 id="org2859a44"><span class="section-number-3">5.2.</span> Rizin's version of ghidra</h3>
<div class="outline-text-3" id="text-5-2">
<p>
This is the generated C code by <i>rizin 0.6.1 @ linux-x86-64</i>.
</p>

<div class="org-src-container">
<pre class="src src-C">[<span style="color: #88ca9f;">0x00001090</span>]&gt; pdg @ fcn.<span style="color: #88ca9f;">00001189</span>

<span style="color: #989898;">// </span><span style="color: #989898;">WARNING: Variable defined which should be unmapped: var_ch</span>
<span style="color: #989898;">// </span><span style="color: #989898;">WARNING: Could not reconcile some variable overlaps</span>
<span style="color: #989898;">// </span><span style="color: #989898;">WARNING: [rz-ghidra] Detected overlap for variable var_14h</span>
<span style="color: #989898;">// </span><span style="color: #989898;">WARNING: [rz-ghidra] Detected overlap for variable var_10h</span>
<span style="color: #989898;">// </span><span style="color: #989898;">WARNING: [rz-ghidra] Detected overlap for variable var_19h</span>

<span style="color: #79a8ff;">void</span> fcn .<span style="color: #88ca9f;">00001189</span>(<span style="color: #79a8ff;">char</span>* <span style="color: #6ae4b9;">arg1</span>, int64_t arg2) {
    <span style="color: #79a8ff;">int32_t</span> <span style="color: #6ae4b9;">iVar1</span>;
    <span style="color: #79a8ff;">uint8_t</span> <span style="color: #6ae4b9;">uVar2</span>;
    <span style="color: #79a8ff;">int64_t</span> <span style="color: #6ae4b9;">var_38h</span>;
    <span style="color: #79a8ff;">char</span>* <span style="color: #6ae4b9;">s</span>;
    <span style="color: #79a8ff;">int64_t</span> <span style="color: #6ae4b9;">var_18h</span>;
    <span style="color: #79a8ff;">int32_t</span> <span style="color: #6ae4b9;">var_10h</span>;
    <span style="color: #79a8ff;">size_t</span> <span style="color: #6ae4b9;">var_ch</span>;

    uVar2         = sym.imp.strlen(arg1);
    var_18h._0_4_ = <span style="color: #88ca9f;">0</span>;
    <span style="color: #ff6f9f;">for</span> (var_18h._4_4_ = <span style="color: #88ca9f;">0</span>; var_18h._4_4_ &lt; <span style="color: #88ca9f;">5</span>;
         var_18h._4_4_ = var_18h._4_4_ + <span style="color: #88ca9f;">1</span>) {
        <span style="color: #ff6f9f;">for</span> (var_10h = <span style="color: #88ca9f;">0</span>; arg1[var_10h] != <span style="color: #00d3d0;">'\0'</span>; var_10h = var_10h + <span style="color: #88ca9f;">1</span>) {
            iVar1 = var_18h + <span style="color: #88ca9f;">1</span>;
            *(var_18h + arg2) =
              (arg1[var_10h] &gt;&gt; <span style="color: #88ca9f;">4</span> | arg1[var_10h] &lt;&lt; <span style="color: #88ca9f;">4</span>) ^ var_18h._4_4_ ^ uVar2;
            var_18h._0_4_ = iVar1;
            <span style="color: #ff6f9f;">if</span> (<span style="color: #88ca9f;">0x13</span> &lt; iVar1) {
                var_18h._0_4_ = <span style="color: #88ca9f;">0</span>;
            }
        }
    }
    <span style="color: #ff6f9f;">return</span>;
}
</pre>
</div>

<p>
I manually removed the type casts from rizin's output since I disabled them for
IDA.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
