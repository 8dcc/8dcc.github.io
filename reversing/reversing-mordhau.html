<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mordhau: From reversing Unreal Engine 4 to breaking animations</title>
<meta property="og:title" content="Mordhau: From reversing Unreal Engine 4 to breaking animations" />
<meta name="author" content="8dcc" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="icon" type="image/x-icon" href="../img/favicon.png" />
<link rel="stylesheet" type="text/css" href="../css/main.css" />
</head>
<body>
<div id="org-div-home-and-up">
  <a accesskey="u" href="index.html">Up</a> | <a accesskey="h" href="../index.html">Home</a>
</div><div id="content" class="content">
<h1 class="title">Mordhau: From reversing Unreal Engine 4 to breaking animations</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#introduction">1. Introduction</a>
<ul>
<li><a href="#the-golden-era-of-the-game">1.1. The golden era of the game</a></li>
<li><a href="#the-amazing-developer-team">1.2. The amazing developer team</a></li>
<li><a href="#my-motives">1.3. My motives</a></li>
</ul>
</li>
<li><a href="#finding-the-necessary-offsets-with-ida-pro">2. Finding the necessary offsets with IDA Pro</a>
<ul>
<li><a href="#important-ida-notes">2.1. Important IDA notes</a></li>
<li><a href="#finding-gnames">2.2. Finding <code>GNames</code></a></li>
<li><a href="#finding-gobjects">2.3. Finding <code>GObjects</code></a></li>
<li><a href="#finding-uworld">2.4. Finding <code>UWorld</code></a></li>
</ul>
</li>
<li><a href="#dumping-and-exploring-the-game-with-uedumper">3. Dumping and exploring the game with <code>UEDumper</code></a></li>
<li><a href="#magic-hexadecimal-tree">4. Magic hexadecimal tree</a></li>
<li><a href="#gallery">5. Gallery</a></li>
</ul>
</div>
</div>

<div id="outline-container-introduction" class="outline-2">
<h2 id="introduction"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-introduction">
<p>
<a href="https://en.wikipedia.org/wiki/Mordhau_(video_game)">Mordhau</a> is a multiplayer video game made in <a href="https://en.wikipedia.org/wiki/Unreal_Engine">Unreal Engine 4</a>. I have been
playing this game for a long time, and I made a lot of friends along the
way. The best part of this game has not been its fighting mechanics, but how
funny the people were.
</p>
</div>

<div id="outline-container-the-golden-era-of-the-game" class="outline-3">
<h3 id="the-golden-era-of-the-game"><span class="section-number-3">1.1.</span> The golden era of the game</h3>
<div class="outline-text-3" id="text-the-golden-era-of-the-game">
<p>
There was a time where you could do a lot of funny glitches, like
<a href="https://www.youtube.com/watch?v=_eaOfSUGv70">flying around</a>. This was by far when I had the most fun with people. The game
was so broken that you could fly anywhere, clip into stuff, and do much more.
</p>


<div id="fig1" class="figure">
<p><img src="../img/mordhau1.jpg" alt="mordhau1.jpg" />
</p>
</div>

<p>
You might think that people were using it to take advantage of people, but that
was not the case. Instead, everyone was teaching glitches to each other, and
goofing around. If someone was abusing a glitch, someone else could just use
another glitch and kill them, or simply vote kick them.
</p>

<p>
However, they ended up patching most of the funny glitches, and even removing
vote-kicks entirely. You could still clip into stuff and do other glitches,
since the developers did such a bad job, but it was not the same.
</p>


<div id="fig2" class="figure">
<p><img src="../img/mordhau2.jpg" alt="mordhau2.jpg" />
</p>
</div>

<p>
The game is only available for Windows (and consoles), but you can still run it
on GNU/Linux through <a href="https://github.com/ValveSoftware/Proton">Proton</a>. A friend I met while playing told me about this,
and it&rsquo;s in fact what made me definitely switch from Windows to GNU/Linux on my
main computer.
</p>

<p>
This means that any memory inspecting (more on this below) has to be done <b>within
the same wine prefix</b>. I personally use <a href="https://github.com/jcnils/protonhax">this tool</a> to accomplish that.
</p>
</div>
</div>

<div id="outline-container-the-amazing-developer-team" class="outline-3">
<h3 id="the-amazing-developer-team"><span class="section-number-3">1.2.</span> The amazing developer team</h3>
<div class="outline-text-3" id="text-the-amazing-developer-team">
<p>
The developers of this game are <i>terrible</i>. In plenty of ways. They are bad at
programming, they are bad at promoting their game, they are bad at basic
decision making, and they are bad at moderating. Basically, they are not mature
enough to handle a big game like this.
</p>

<p>
The game has no anti-cheat at all. You can read and write any values in memory,
and change whatever you want as if this was <a href="https://github.com/8dcc/hl-cheat">Half-Life 1</a>. I heard they <i>had</i> an
anti-cheat at some point, but they removed it for some reason.
</p>

<p>
Not only do they lack an anti-cheat, but they look like <b>they want people to
cheat</b> in their game. Years ago I noticed that they published an update with a
<a href="https://en.wikipedia.org/wiki/Program_database">PDB</a> file, which contains very useful debugging information. I remember copying
it quickly after noticing, because I <i>obviously</i> thought it was a mistake. Well,
let&rsquo;s have a look at the binaries folder now.
</p>


<div id="fig3" class="figure">
<p><img src="../img/mordhau3.png" alt="mordhau3.png" />
</p>
</div>

<p>
There it is, the third file on the list. They have been shipping the debugging
information along the game for <b>years</b>. This is a big mistake, that allows anyone
(with some reversing knowledge) to basically browse the source code of the
game. I am assuming they don&rsquo;t know what the file is, so they just leave it in
the output folder because they assume that the game needs it.
</p>

<p>
You might also notice the suspicious <code>.i64</code> files. In case the reader is not
familiar with reversing, these are 64-bit <a href="https://en.wikipedia.org/wiki/Interactive_Disassembler">IDA Pro</a> databases, and they will be
covered below.
</p>

<p>
As a side note, I think it&rsquo;s very funny that this could happen to the developers
to begin with. I don&rsquo;t know what they used to compile this program, but I think
the compiler/IDE should only generate this <code>.pdb</code> file when compiling in <i>debug
mode</i>, and not in <i>release mode</i>. I am not sure if this means that they are
shipping the debug version or not.
</p>

<p>
In any case, this is very funny, and it reminded me of how I didn&rsquo;t know what
object files were when I first started with C/C++, so I was not sure about
including them on my git projects or not.
</p>

<p>
This article was been written in May of 2024, so keep in mind that they might
have actually removed the <code>.pdb</code> file after I spoon-fed this information to
them. If it&rsquo;s still there, you can import it from IDA Pro, although the rest of
this article doesn&rsquo;t asume you have imported it.
</p>
</div>
</div>

<div id="outline-container-my-motives" class="outline-3">
<h3 id="my-motives"><span class="section-number-3">1.3.</span> My motives</h3>
<div class="outline-text-3" id="text-my-motives">
<p>
I like reverse engineering, and I enjoy a few video-games. That&rsquo;s why, if I
really enjoy playing a game, I might try to reverse engineer it, to see how it
was done. Since I use GNU/Linux, I mainly enjoy reversing native Linux programs
and games. Even if I really enjoy a Windows video-game, the reversing interest
is usually not big enough to make me switch to Windows.
</p>

<p>
However, since I had been playing Mordhau for such a long time, I decided to
give it a try and, through Proton, see if I could find something interesting. I
did find <a href="#gallery">a lot of interesting stuff</a>. I already knew how bad the game was, but
noticing how many things were client-sided definitely made me realize that the
developers were clueless.
</p>

<p>
I knew I could get banned, because I found things that I had never seen anyone
do before, but I decided that I had played the game long enough, and that I
didn&rsquo;t care if I got banned. I rather have fun my way, than just play normally
to avoid getting banned. I even took notes on writing this article once I got
banned.
</p>

<p>
I don&rsquo;t particularly enjoy <i>cheating</i>, as in, getting an unfair advantage over
other players. I like reversing and making cheats because I enjoy the low-level
aspect of understanding a game enough to do something that the developers are
actively trying to prevent you from doing. That was a long sentence, by the way.
</p>

<p>
And indeed, I started reversing the game on January 2024, and I didn&rsquo;t get
banned until May of 2024. I think I saw a moderator in-game once&#x2026; and it was
before starting reversing the game. In the end, it was a jealous kid who
reported my account because I wouldn&rsquo;t tell him how to <a href="https://en.wikipedia.org/wiki/T-pose">T-pose</a> in game. They
immediately banned me exclusively based on my screenshots.
</p>


<div id="fig4" class="figure">
<p><img src="../img/mordhau4.png" alt="mordhau4.png" />
</p>
</div>

<p>
Anyhow, this is good news, since now I am able to explain the reverse
engineering process without being worried about bans, which was something I have
wanted since I started reversing the game, just like I did with <a href="devildaggers.html">Devil Daggers</a> or
<a href="reversing-tf2-bsendpacket.html">TF2</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-finding-the-necessary-offsets-with-ida-pro" class="outline-2">
<h2 id="finding-the-necessary-offsets-with-ida-pro"><span class="section-number-2">2.</span> Finding the necessary offsets with IDA Pro</h2>
<div class="outline-text-2" id="text-finding-the-necessary-offsets-with-ida-pro">
<p>
As I said, the game is made in Unreal Engine 4. There is an amazing tool called
<a href="https://github.com/Spuckwaffel/UEDumper">UEDumper</a>, which allows you to explore the game&rsquo;s structures, even live. However,
this is a &ldquo;universal&rdquo; dumper, and it needs some offsets. We are going to get
them using <a href="https://en.wikipedia.org/wiki/Interactive_Disassembler">IDA Pro</a>.
</p>

<p>
This is meant to be a quick guide for getting the needed offsets by <code>UEDumper</code>, so
I won&rsquo;t be diving into too much detail. The general method for finding them is
to look at the Unreal Engine 4 source code, find where these symbols are used,
and look for cross references you can use. Try looking for close strings, and
things you can easily find from IDA.
</p>
</div>

<div id="outline-container-important-ida-notes" class="outline-3">
<h3 id="important-ida-notes"><span class="section-number-3">2.1.</span> Important IDA notes</h3>
<div class="outline-text-3" id="text-important-ida-notes">
<p>
Remember to open the <code>Mordhau-Win64-Shipping.exe</code> file, not <code>Mordhau.exe</code> files. We
will also use this executable with <code>UEDumper</code> below.
</p>

<p>
Also, you will need some settings in order to find the required offsets.
</p>

<p>
First, open the <i>Strings</i> subview with <i>View &gt; Open subviews &gt; Strings</i>, or by
pressing <code>Shift+F12</code>. From there, right click on the string list and press
<i>Setup</i>. Make sure all C-style string types are allowed.
</p>


<div id="fig5" class="figure">
<p><img src="../img/mordhau5.png" alt="mordhau5.png" />
</p>
</div>

<p>
You can then press <code>Ctrl+F</code> in the <i>Strings</i> view to search for strings.
</p>
</div>
</div>

<div id="outline-container-finding-gnames" class="outline-3">
<h3 id="finding-gnames"><span class="section-number-3">2.2.</span> Finding <code>GNames</code></h3>
<div class="outline-text-3" id="text-finding-gnames">
<p>
Search for the string <code>MulticastDelegateProperty</code>, and choose the one with C type,
not 16-bits.
</p>


<div id="fig6" class="figure">
<p><img src="../img/mordhau6.png" alt="mordhau6.png" />
</p>
</div>

<p>
Double-click the string, then open the cross-references window by right-clicking
the <code>aMulticastdeleg</code> symbol, or by pressing the <code>x</code> key. Jump to its only xref.
</p>


<div id="fig7" class="figure">
<p><img src="../img/mordhau7.png" alt="mordhau7.png" />
</p>
</div>

<p>
You are now in a big subroutine that handles a lot of strings. I opened the
decompiler window so it&rsquo;s easier to tell what&rsquo;s going on, but it&rsquo;s not
necessary. From the assembly view, scroll to the top of the subroutine and list
its cross references.
</p>


<div id="fig8" class="figure">
<p><img src="../img/mordhau8.png" alt="mordhau8.png" />
</p>
</div>

<p>
Jump to the first one, the <i>Direction</i> of the xref should be <i>Up</i>. The function
where the <code>MulticastDelegateProperty</code> string was located is being called with the
<code>GNames</code> structure as its argument, so we should be looking for something like
this.
</p>


<div id="fig9" class="figure">
<p><img src="../img/mordhau9.png" alt="mordhau9.png" />
</p>
</div>

<p>
As you can see, the address of <code>stru_57BEE80</code> is being loaded into <code>rcx</code>, which
according to the Windows x64 calling convention, is used for the first parameter
when calling a function. Note that the function call appears highlighted because
I marked the location from IDA.
</p>

<p>
However, <code>0x57BEE80</code> is not the <i>real</i> offset of <code>GNames</code>. This is the &ldquo;absolute&rdquo;
offset that IDA shows us, which would be accurate if we were loaded at
<code>0x0</code>. However, we want to get the relative offset to where the executable was
mapped in memory. To get this relative offset, we will need to subtract the
<code>ImageBase</code>, which we can obtain by typing <code>get_imagebase()</code> in the IDA command
prompt.
</p>


<div id="fig10" class="figure">
<p><img src="../img/mordhau10.png" alt="mordhau10.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-finding-gobjects" class="outline-3">
<h3 id="finding-gobjects"><span class="section-number-3">2.3.</span> Finding <code>GObjects</code></h3>
<div class="outline-text-3" id="text-finding-gobjects">
<p>
Search for the string <code>CloseDisregardForGC</code>, and jump to its only xref. In the
assembly, you will see that the string is being used as a function
parameter.
</p>


<div id="fig11" class="figure">
<p><img src="../img/mordhau11.png" alt="mordhau11.png" />
</p>
</div>

<p>
Right before that function call, you can see that it&rsquo;s checking for a
<code>byte_57D7AEC</code> value. This is the assembly generated when compiling the following
Unreal Engine code.
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #ff6f9f;">if</span> (GUObjectArray.OpenForDisregardForGC())
{
    SCOPED_BOOT_TIMING(<span style="color: #00d3d0;">"CloseDisregardForGC"</span>);
    GUObjectArray.CloseDisregardForGC();
}
</pre>
</div>

<p>
The <code>OpenForDisregardForGC</code> value being checked is a 4-byte padded boolean. In the
<code>GUObjectArray</code> structure, it&rsquo;s located right before the <code>ObjObjects</code>
array. Therefore, we can simply add 4 bytes to that <code>byte_57D7AEC</code> value, and we
will get the offset of <code>GObjects</code>. Again, remember to also subtract the <code>ImageBase</code>.
</p>
</div>
</div>

<div id="outline-container-finding-uworld" class="outline-3">
<h3 id="finding-uworld"><span class="section-number-3">2.4.</span> Finding <code>UWorld</code></h3>
<div class="outline-text-3" id="text-finding-uworld">
<p>
Search for the string <code>Failed to load package '%s' into a new game world.</code>, and
jump to its only xref. Once you are in the subroutine, press <code>F5</code> to decompile it.
</p>


<div id="fig12" class="figure">
<p><img src="../img/mordhau12.png" alt="mordhau12.png" />
</p>
</div>

<p>
In this case, we were lucky and the function call with our string has no labels
near it, and the the decompiled subroutine looks pretty clean.
</p>

<p>
We are looking for that <code>qword_590DC40</code> line at the bottom. That&rsquo;s the <code>UWorld</code>
global variable, but remember that we still need to subtract the <code>ImageBase</code>.
</p>

<p>
Although this was the ideal scenario, the decompiler might not always interpret
the branches this way, and might show a bunch of jumps across labels. The
function might look something like this:
</p>

<div class="org-src-container">
<pre class="src src-C">  <span style="color: #989898;">// </span><span style="color: #989898;">...</span>
  <span style="color: #989898;">// </span><span style="color: #989898;">Label mess, qword gets assigned somewhere over here</span>

<span style="color: #88ca9f;">LABEL_123</span>:
  sub_1822B30(&amp;PerformanceCount, L<span style="color: #00d3d0;">"Failed to load package '</span><span style="color: #ff6f9f;">%s</span><span style="color: #00d3d0;">' into a new game world."</span>, v124);
  <span style="color: #ff6f9f;">if</span> ( v6 == &amp;PerformanceCount )
  {
      v7 = PerformanceCount;
  }
  <span style="color: #ff6f9f;">else</span>
  {
      <span style="color: #989898;">// </span><span style="color: #989898;">...</span>
  }

  <span style="color: #989898;">// </span><span style="color: #989898;">...</span>
  <span style="color: #989898;">// </span><span style="color: #989898;">Subroutine returns, qword assigment is not here</span>

  <span style="color: #ff6f9f;">return</span> <span style="color: #88ca9f;">0</span>;
}
</pre>
</div>

<p>
In that case, we would have to jump to the xref of that <code>LABEL_123</code> and look for
the same <code>qword</code> assignment below the jump.
</p>
</div>
</div>
</div>

<div id="outline-container-dumping-and-exploring-the-game-with-uedumper" class="outline-2">
<h2 id="dumping-and-exploring-the-game-with-uedumper"><span class="section-number-2">3.</span> Dumping and exploring the game with <code>UEDumper</code></h2>
<div class="outline-text-2" id="text-dumping-and-exploring-the-game-with-uedumper">
<p>
As I mentioned, you will first need to edit some files, and compile the <code>UEDumper</code>
project itself.
</p>

<p>
You will have to edit <code>UEDumper-1.8/UEDumper/Engine/Userdefined/Offsets.h</code>, and
replace the offsets you got from IDA in the <code>setOffsets()</code> function. The format
should be the following.
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #ff6f9f;">inline</span> <span style="color: #88ca9f;">std</span>::<span style="color: #79a8ff;">vector</span>&lt;Offset&gt; <span style="color: #4ae2ff;">setOffsets</span>()
{
    <span style="color: #88ca9f;">std</span>::<span style="color: #79a8ff;">vector</span>&lt;Offset&gt; <span style="color: #6ae4b9;">offsets</span>;

    <span style="color: #989898;">// </span><span style="color: #989898;">Mordhau-Win64-Shipping.exe</span>
    offsets.push_back({ OFFSET_ADDRESS | OFFSET_DS, <span style="color: #00d3d0;">"OFFSET_GNAMES"</span>, <span style="color: #88ca9f;">0x57ABCD</span> });
    offsets.push_back({ OFFSET_ADDRESS | OFFSET_DS, <span style="color: #00d3d0;">"OFFSET_GOBJECTS"</span>, <span style="color: #88ca9f;">0x57CDEF0</span> });
    offsets.push_back({ OFFSET_ADDRESS | OFFSET_DS | OFFSET_LIVE_EDITOR, <span style="color: #00d3d0;">"OFFSET_UWORLD"</span>, <span style="color: #88ca9f;">0x58FEDCB</span> });

    <span style="color: #ff6f9f;">return</span> offsets;
}
</pre>
</div>

<p>
The first offset should be <code>GNames</code>, the second <code>GObjects</code> and the third
<code>UWorld</code>. Again, make sure you have subtracted the <code>ImageBase</code>!
</p>

<p>
Then, you can save the file and compile the project using the &ldquo;Release&rdquo; version
in the top bar of Visual Studio. Unfortunately I can&rsquo;t insert a screenshot
because I compiled the project once, back when I had Windows installed. Just
imagine how often the developers update their game.
</p>

<p>
Now you can open the <code>UEDumper.exe</code> file on the <code>build</code> folder. As I mentioned on
the introduction, if you are running the game in GNU/Linux through Proton, you
will need to use some kind of <a href="https://github.com/jcnils/protonhax">tool</a> to run the dumper under the same wine prefix
as Mordhau.
</p>


<div id="fig13" class="figure">
<p><img src="../img/mordhau13.png" alt="mordhau13.png" />
</p>
</div>

<p>
Enter any project name and the name of the Mordhau executable. Again, remember
this is not <code>Mordhau.exe</code> but <code>Mordhau-Win64-Shipping.exe</code>. When you have done this,
press &ldquo;Dump Game&rdquo;. If your offsets were correct, you should see something like
this.
</p>


<div id="fig14" class="figure">
<p><img src="../img/mordhau14.png" alt="mordhau14.png" />
</p>
</div>

<p>
Once it&rsquo;s done loading, you can start inspecting the game live. Press &ldquo;Live
editor&rdquo; on the top bar, then the &ldquo;Add Inspector&rdquo; button, then switch to the &ldquo;Add
Offset&rdquo; tab, select <code>UWorld</code>, and enter any display name.
</p>


<div id="fig15" class="figure">
<p><img src="../img/mordhau15.png" alt="mordhau15.png" />
</p>
</div>

<p>
After pressing &ldquo;Add&rdquo;, you should be able to see the structures in a nice
format. Expand &ldquo;UWorld&rdquo;, and you will be able to navigate the game&rsquo;s structures
by name. Each <code>+0030</code> value in red represents an offset relative to the parent. If
you expand a structure, you are &ldquo;dereferencing&rdquo; it, and its offsets will be
relative to that parent. In other words, you are traversing a chain (or tree) of
pointers.
</p>
</div>
</div>

<div id="outline-container-magic-hexadecimal-tree" class="outline-2">
<h2 id="magic-hexadecimal-tree"><span class="section-number-2">4.</span> Magic hexadecimal tree</h2>
<div class="outline-text-2" id="text-magic-hexadecimal-tree">
<p>
These are the most interesting values I have found. If you have been following
until now, you might realize what these numbers mean, and what to do with them.
</p>

<div class="org-src-container">
<pre class="src src-C">&lt;UWorld&gt;
 |
 |- <span style="color: #88ca9f;">0x120</span>
 |  |
 |  |- <span style="color: #88ca9f;">0x689</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 0</span>
 |  |- <span style="color: #88ca9f;">0x697</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 1</span>
 |
 |- <span style="color: #88ca9f;">0x180</span>, <span style="color: #88ca9f;">0x38</span>, <span style="color: #88ca9f;">0x0</span>, <span style="color: #88ca9f;">0x30</span>
    |
    |- <span style="color: #88ca9f;">0x2B8</span>, <span style="color: #88ca9f;">0x23C</span>
    |- <span style="color: #88ca9f;">0x28C</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Not useful</span>
    |- <span style="color: #88ca9f;">0xA28</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try fixing</span>
    |- <span style="color: #88ca9f;">0xDB1</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 1</span>
    |- <span style="color: #88ca9f;">0x260</span>
    |  |
    |  |- <span style="color: #88ca9f;">0x8A0</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Next 2 are client-sided, unfortunately</span>
    |  |- <span style="color: #88ca9f;">0x8A4</span>
    |  |- <span style="color: #88ca9f;">0x8A8</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Vehicle. Others can use, carefuly</span>
    |  |- <span style="color: #88ca9f;">0x8C4</span>
    |  |- <span style="color: #88ca9f;">0x8CC</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Vehicle too</span>
    |  |- <span style="color: #88ca9f;">0xDE8</span>
    |  |- <span style="color: #88ca9f;">0x6A0</span>
    |     |- <span style="color: #88ca9f;">0xC8</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try fixing, with next one</span>
    |     |- <span style="color: #88ca9f;">0xEC</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 9999, not client-sided</span>
    |
    |- <span style="color: #88ca9f;">0x2A0</span>
       |
       |- <span style="color: #88ca9f;">0xB80</span>, <span style="color: #88ca9f;">0x128</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Not useful</span>
       |- <span style="color: #88ca9f;">0xF09</span>         <span style="color: #989898;">// </span><span style="color: #989898;">Try 2, new gameplay</span>
       |- <span style="color: #88ca9f;">0xB78</span>, <span style="color: #88ca9f;">0x830</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Careful</span>
       |- <span style="color: #88ca9f;">0x6A0</span>, <span style="color: #88ca9f;">0xF8</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Client-sided, unfortunately</span>
       |- <span style="color: #88ca9f;">0xB08</span>
       |  |
       |  |- <span style="color: #88ca9f;">0x61</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try kick, etc.</span>
       |  |- <span style="color: #88ca9f;">0x6C</span>
       |  |- <span style="color: #88ca9f;">0x6D</span>
       |  |- <span style="color: #88ca9f;">0x6E</span>
       |
       |- <span style="color: #88ca9f;">0x288</span>
       |  |
       |  |- <span style="color: #88ca9f;">0xC49</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Not useful</span>
       |  |- <span style="color: #88ca9f;">0xD1C</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 1, very OP</span>
       |
       |- <span style="color: #88ca9f;">0xE66</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try 1</span>
       |- <span style="color: #88ca9f;">0xEA4</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try increasing</span>
       |- <span style="color: #88ca9f;">0xEA8</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try -1</span>
       |- <span style="color: #88ca9f;">0xE94</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Not sure if it does anything</span>
       |- <span style="color: #88ca9f;">0x1029</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Needs another option to be useful</span>
       |- <span style="color: #88ca9f;">0x8C4</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try -1</span>
       |- <span style="color: #88ca9f;">0x8CC</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try -1</span>
       |
       |- <span style="color: #88ca9f;">0x1200</span>
       |  |
       |  |- <span style="color: #88ca9f;">0xCEC</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Next 3 will feel weird</span>
       |  |- <span style="color: #88ca9f;">0xCF4</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try... non ranged?</span>
       |  |- <span style="color: #88ca9f;">0xD00</span>
       |  |- <span style="color: #88ca9f;">0xD1F</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Not useful</span>
       |  |- <span style="color: #88ca9f;">0xCC8</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try ranged</span>
       |  |- <span style="color: #88ca9f;">0xEF8</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Useful in very few weapons</span>
       |  |- <span style="color: #88ca9f;">0xCBC</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try throw</span>
       |  |- <span style="color: #88ca9f;">0xD23</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Extremelly goofy one, personal favorite</span>
       |  |- <span style="color: #88ca9f;">0x1A0C</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Needed for a previous option</span>
       |  |- <span style="color: #88ca9f;">0xCB9</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try pavise</span>
       |  |- <span style="color: #88ca9f;">0x1C98</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Very goofy, pavise again</span>
       |
       |- <span style="color: #88ca9f;">0x11F8</span>
          |
          |- <span style="color: #88ca9f;">0xCEC</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Most are shared with 0x1200</span>
          |- <span style="color: #88ca9f;">0xCF4</span>
          |- <span style="color: #88ca9f;">0xD00</span>
          |- <span style="color: #88ca9f;">0xD1F</span>
          |- <span style="color: #88ca9f;">0xD40</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try heal, unfortunately not shared</span>
          |- <span style="color: #88ca9f;">0xCC8</span>
          |- <span style="color: #88ca9f;">0xEF8</span>
          |- <span style="color: #88ca9f;">0xCBC</span>
          |- <span style="color: #88ca9f;">0xD23</span>
          |- <span style="color: #88ca9f;">0x1A0C</span>
          |- <span style="color: #88ca9f;">0xCB9</span>
          |- <span style="color: #88ca9f;">0x1C98</span>
          |- <span style="color: #88ca9f;">0xF40</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try polehammer, for example</span>
          |- <span style="color: #88ca9f;">0xF41</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Should be always 1</span>
          |- <span style="color: #88ca9f;">0xF54</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try 0</span>
          |- <span style="color: #88ca9f;">0xF58</span>   <span style="color: #989898;">// </span><span style="color: #989898;">Try 0</span>
          |- <span style="color: #88ca9f;">0x13E0</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try maul, for example</span>
          |- <span style="color: #88ca9f;">0x13E1</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Should be always 1</span>
          |- <span style="color: #88ca9f;">0x13F0</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try lowering a bit, combine with next 2</span>
          |- <span style="color: #88ca9f;">0x13F4</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 0</span>
          |- <span style="color: #88ca9f;">0x13F8</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 0</span>
          |- <span style="color: #88ca9f;">0xD40</span>, <span style="color: #88ca9f;">0xB0</span>
             |
             |- <span style="color: #88ca9f;">0x14</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Be creative</span>
             |- <span style="color: #88ca9f;">0x18</span>
             |- <span style="color: #88ca9f;">0x1C</span>
             |- <span style="color: #88ca9f;">0x7C</span>  <span style="color: #989898;">// </span><span style="color: #989898;">Try 0 for next 3</span>
             |- <span style="color: #88ca9f;">0x80</span>
             |- <span style="color: #88ca9f;">0x84</span>
             |- ...   <span style="color: #989898;">// </span><span style="color: #989898;">Groups of 6 repeat</span>
</pre>
</div>

<p>
I am sorry if someone was expecting a quick guide on how to break X
animation. You can do everything I did with the numbers above. I intentionally
wanted to make this misleading to inexperienced programmers, so the game
developers couldn&rsquo;t figure out how I did my magic.
</p>

<p>
When the game updates, you just need to find and change the <code>UWorld</code> offset, and
you will be good to go most of the times. If something bigger changes, you can
just update the values easily.
</p>

<p>
And more importantly, get creative. I found all this stuff by trial and error.
</p>
</div>
</div>

<div id="outline-container-gallery" class="outline-2">
<h2 id="gallery"><span class="section-number-2">5.</span> Gallery</h2>
<div class="outline-text-2" id="text-gallery">
<p>
Since my account was banned, I decided to upload my funniest screenshots here.
</p>


<div id="fig16" class="figure">
<p><img src="../img/mordhau-ss1.jpg" alt="mordhau-ss1.jpg" />
</p>
</div>

<div id="fig17" class="figure">
<p><img src="../img/mordhau-ss2.jpg" alt="mordhau-ss2.jpg" />
</p>
</div>

<div id="fig18" class="figure">
<p><img src="../img/mordhau-ss3.jpg" alt="mordhau-ss3.jpg" />
</p>
</div>

<div id="fig19" class="figure">
<p><img src="../img/mordhau-ss4.jpg" alt="mordhau-ss4.jpg" />
</p>
</div>

<div id="fig20" class="figure">
<p><img src="../img/mordhau-ss5.jpg" alt="mordhau-ss5.jpg" />
</p>
</div>

<div id="fig21" class="figure">
<p><img src="../img/mordhau-ss6.jpg" alt="mordhau-ss6.jpg" />
</p>
</div>

<div id="fig22" class="figure">
<p><img src="../img/mordhau-ss7.jpg" alt="mordhau-ss7.jpg" />
</p>
</div>

<div id="fig23" class="figure">
<p><img src="../img/mordhau-ss8.jpg" alt="mordhau-ss8.jpg" />
</p>
</div>

<div id="fig24" class="figure">
<p><img src="../img/mordhau-ss9.jpg" alt="mordhau-ss9.jpg" />
</p>
</div>

<div id="fig25" class="figure">
<p><img src="../img/mordhau-ss10.jpg" alt="mordhau-ss10.jpg" />
</p>
</div>

<div id="fig26" class="figure">
<p><img src="../img/mordhau-ss11.jpg" alt="mordhau-ss11.jpg" />
</p>
</div>

<div id="fig27" class="figure">
<p><img src="../img/mordhau-ss12.jpg" alt="mordhau-ss12.jpg" />
</p>
</div>

<div id="fig28" class="figure">
<p><img src="../img/mordhau-ss13.jpg" alt="mordhau-ss13.jpg" />
</p>
</div>

<div id="fig29" class="figure">
<p><img src="../img/mordhau-ss14.jpg" alt="mordhau-ss14.jpg" />
</p>
</div>

<div id="fig30" class="figure">
<p><img src="../img/mordhau-ss15.jpg" alt="mordhau-ss15.jpg" />
</p>
</div>

<div id="fig31" class="figure">
<p><img src="../img/mordhau-ss16.jpg" alt="mordhau-ss16.jpg" />
</p>
</div>

<div id="fig32" class="figure">
<p><img src="../img/mordhau-ss17.jpg" alt="mordhau-ss17.jpg" />
</p>
</div>

<div id="fig33" class="figure">
<p><img src="../img/mordhau-ss18.jpg" alt="mordhau-ss18.jpg" />
</p>
</div>
</div>
</div>
</div>
</body>
</html>
